<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="board">
	
	<sql id="search">
		<if test="searchType != null and keyword !='' ">
			<if test="searchType == 'board_title'.toString()">
				and board_title like CONCAT('%', #{keyword}, '%')
			</if>
			<if test="searchType == 'board_head'.toString()">
				and board_head like CONCAT('%', #{keyword}, '%')
			</if>
			<if test="searchType == 'board_content'.toString()">
				and board_content like CONCAT('%', #{keyword}, '%')
			</if>
			<if test="searchType == 'board_writer'.toString()">
				and board_writer like CONCAT('%', #{keyword}, '%')
			</if>
			<if test="searchType == 'all'.toString()">
				and ( 
	                     board_title CONCAT('%', #{keyword}, '%')
	                    OR
	                     board_head like CONCAT('%', #{keyword}, '%')
	                    OR
	                     board_content like CONCAT('%', #{keyword}, '%')
	                    OR
	                    board_writer like CONCAT('%', #{keyword}, '%')
	                )
			</if>
		</if>
	</sql>
	
	<select id="boardList" resultType="boardDto" >
		select * from board  where board_no > 0
			<include refid="search"></include>
		order by board_no desc
		limit #{pageStart}, #{perPageNum}
	</select>
	
	<select id="listCount" resultType="int" >
		select count(board_no) from board where board_no > 0
		<include refid="search"></include>
	</select>
	
	<insert id="regist" parameterType="boardDto">
		insert into board values(
					#{board_no},
					#{board_head},#{board_title},now(),#{board_writer},0,
					#{board_pw},#{board_content}
		)
	</insert>
	
	<update id="edit" parameterType="boardDto">
		update board 
		set
				board_head = #{board_head}, 
				board_title = #{board_title},
				board_content = #{board_content}
		where
				board_no= #{board_no}
	</update>
	
	<select id="getBoardSequence" resultType="int">
		select (select * from (select max(board_no)+1 from board) next) from dual
	</select>
	
	<select id="getFileSequence" resultType="int">
		select (select * from (select max(file_no)+1 from file) next) from dual
	</select>
	
	<insert id="upload" parameterType="int">
		insert into file values(
			#{file_no},
			#{file_uploadname},
			#{file_savename},
			#{file_type},
			#{file_size},
			#{board_no}
		)
	</insert>
	
	
	<select id="view" resultType="boardDto" parameterType="int">
		select * from board where board_no = #{board_no}
	</select>
	
	<update id="readCount" parameterType="int">
		update board set board_readCount = board_readCount+1 where board_no = #{board_no}
	</update>
	
	<delete id="delete" parameterType="int">
		delete from board where board_no = #{board_no}
	</delete>
	
</mapper>



