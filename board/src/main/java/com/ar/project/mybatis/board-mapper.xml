<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="board">
	
	<sql id="search">
		<if test="@com.ar.common.util.StringUtil@isNotEmpty(searchType)">
			<if test="@com.ar.common.util.StringUtil@equals(searchType, 'board_title')">
				and board_title like CONCAT('%', #{keyword}, '%')
			</if>
			<if test="@com.ar.common.util.StringUtil@equals(searchType, 'board_head')">
				and board_head like CONCAT('%', #{keyword}, '%')
			</if>
			<if test="@com.ar.common.util.StringUtil@equals(searchType, 'board_content')">
				and board_content like CONCAT('%', #{keyword}, '%')
			</if>
			<if test="@com.ar.common.util.StringUtil@equals(searchType, 'board_writer')">
				and board_writer like CONCAT('%', #{keyword}, '%')
			</if>
			<if test="@com.ar.common.util.StringUtil@equals(searchType, 'all')">
				and ( 
	                     board_title like CONCAT('%', #{keyword}, '%')
	                    OR
	                     board_head like CONCAT('%', #{keyword}, '%')
	                    OR
	                     board_content like CONCAT('%', #{keyword}, '%')
	                    OR
	                    board_writer like CONCAT('%', #{keyword}, '%')
	                )
			</if>
		</if>
	</sql>
	<sql id="orderBy">
		<if test="@com.ar.common.util.StringUtil@equals(sortList, 'desc')">
			order by board_no desc
		</if>
		<if test="@com.ar.common.util.StringUtil@equals(sortList, 'asc')">
			order by board_no asc
		</if>
	</sql>
	
	
	<select id="boardList" resultType="boardDto" >
		SELECT board_no
				   , board_head
				   , board_title
				   , board_write_date
				   , board_writer
				   , board_readcount
				   , board_content
   FROM board
 WHERE board_no > 0
<include refid="search"></include>
<include refid="orderBy"></include>
	LIMIT #{pageStart}, #{perPageNum}
	</select>
	
	<select id="listCount" resultType="int" >
		select count(board_no) from board where board_no > 0
		<include refid="search"></include>
	</select>
	
	<insert id="regist" parameterType="boardDto">
		insert into board values(
					#{board_no},
					#{board_head},#{board_title},now(),#{board_writer},0,0,
					#{board_content}
		)
	</insert>
	
	<update id="edit" parameterType="boardDto">
		update board 
		set
				board_head = #{board_head}, 
				board_title = #{board_title},
				board_content = #{board_content}
		where
				board_no= #{board_no}
	</update>
	
	
	<select id="getBoardSequence" resultType="int">
		select (select * from (select max(board_no)+1 from board) next) from dual
	</select>
	
	<select id="getFileSequence" resultType="int">
		select (select * from (select max(file_no)+1 from file) next) from dual
	</select>
	
	<insert id="upload" parameterType="fileDto">
		insert into file values(
			#{file_no},
			#{file_uploadname},
			#{file_savename},
			#{file_size},
			#{board_no}
		)
	</insert>
	
	
	<select id="view" resultType="boardDto" parameterType="int">
		select * from board where board_no = #{board_no}
	</select>
	
	<select id="fileList" parameterType="int" resultType="fileDto">
		select * from file where board_no=#{board_no}
	</select>
	
	<select id="getFileNum" resultType="fileDto" parameterType="int">
		select * from file where file_no=#{file_no}
	</select>
	
	<update id="readCount" parameterType="int">
		update board set board_readCount = board_readCount+1 where board_no = #{board_no}
	</update>
	
	<delete id="delete" parameterType="int">
		delete from board where board_no = #{board_no}
	</delete>
	
	<delete id="fileDelete" parameterType="int">
		delete from file where board_no=#{board_no}
	</delete>
	
	<delete id="deleteFileNo" parameterType="int">
		delete from file where file_no=#{file_no}
	</delete>
	
</mapper>



